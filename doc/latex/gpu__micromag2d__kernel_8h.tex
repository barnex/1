\hypertarget{gpu__micromag2d__kernel_8h}{
\section{gpu\_\-micromag2d\_\-kernel.h File Reference}
\label{gpu__micromag2d__kernel_8h}\index{gpu\_\-micromag2d\_\-kernel.h@{gpu\_\-micromag2d\_\-kernel.h}}
}
{\ttfamily \#include \char`\"{}tensor.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}gputil.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}param.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}gpufft2.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}assert.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}timer.h\char`\"{}}\par
{\ttfamily \#include $<$stdio.h$>$}\par
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structtensor}{tensor} $\ast$ \hyperlink{gpu__micromag2d__kernel_8h_a4d3ec41beeae62a440235c9ad7ae4fbf}{gpu\_\-micromag2d\_\-kernel} (\hyperlink{structparam}{param} $\ast$p)
\item 
void \hyperlink{gpu__micromag2d__kernel_8h_a794e8985484e58c2fdf4d4e5d5f5bf82}{gpu\_\-init\_\-and\_\-FFT\_\-Greens\_\-kernel\_\-elements\_\-micromag2d} (\hyperlink{structtensor}{tensor} $\ast$dev\_\-kernel, int $\ast$kernelSize, int $\ast$exchInConv, float $\ast$FD\_\-cell\_\-size, int $\ast$repetition, float $\ast$dev\_\-qd\_\-P\_\-10, float $\ast$dev\_\-qd\_\-W\_\-10, \hyperlink{structgpuFFT3dPlan}{gpuFFT3dPlan} $\ast$kernel\_\-plan)
\item 
\_\-\_\-global\_\-\_\- void \hyperlink{gpu__micromag2d__kernel_8h_a75d46c5dc5252ea534486569520c04b4}{\_\-gpu\_\-init\_\-Greens\_\-kernel\_\-elements\_\-micromag2d} (float $\ast$dev\_\-temp, int Nkernel\_\-Y, int Nkernel\_\-Z, int Nkernel\_\-storage\_\-Z, int exchInConv\_\-Y, int exchInConv\_\-Z, int co1, int co2, float FD\_\-cell\_\-size\_\-Y, float FD\_\-cell\_\-size\_\-Z, int repetition\_\-Y, int repetition\_\-Z, float $\ast$qd\_\-P\_\-10, float $\ast$qd\_\-W\_\-10)
\item 
\_\-\_\-device\_\-\_\- float \hyperlink{gpu__micromag2d__kernel_8h_ad89b6a93d5e726c5dba1a894ce72dbd8}{\_\-gpu\_\-get\_\-Greens\_\-element\_\-micromag2d} (int Nkernel\_\-Y, int Nkernel\_\-Z, int exchInConv\_\-Y, int exchInConv\_\-Z, int co1, int co2, int b, int c, float FD\_\-cell\_\-size\_\-Y, float FD\_\-cell\_\-size\_\-Z, int repetition\_\-Y, int repetition\_\-Z, float $\ast$dev\_\-qd\_\-P\_\-10, float $\ast$dev\_\-qd\_\-W\_\-10)
\item 
\_\-\_\-global\_\-\_\- void \hyperlink{gpu__micromag2d__kernel_8h_a3bd5e71e192bf450b0f0dccfcb6be275}{\_\-gpu\_\-extract\_\-real\_\-parts\_\-micromag2d} (float $\ast$dev\_\-kernel\_\-array, float $\ast$dev\_\-temp)
\item 
void \hyperlink{gpu__micromag2d__kernel_8h_ac5ac30ce506df77ebe6bd98ee1a3b69a}{initialize\_\-Gauss\_\-quadrature\_\-on\_\-gpu\_\-micromag2d} (float $\ast$dev\_\-qd\_\-W\_\-10, float $\ast$dev\_\-qd\_\-P\_\-10, float $\ast$FD\_\-cell\_\-size)
\item 
void \hyperlink{gpu__micromag2d__kernel_8h_a1fdce7ad13365fdcea39fa6e8d795b9a}{get\_\-Quad\_\-Points\_\-micromag2d} (float $\ast$gaussQP, float $\ast$stdgaussQ, int qOrder, double a, double b)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Initialization of the micromagnetic kernel for 2D simulations with invariance considered in the x-\/direction of all microstructural properties and all fields. In the y-\/ and z-\/direction, the dimensions should be larger then one (possibly coarse level) FD cell. This kernel contains the demag and exchange (if wanted) contribution and is adapted to the FFT dimensions of gpufft.cu. The Kernel components are Fourier transformed and only the real parts are stored on the device. The correction factor 1/(dimensions FFTs) is included. Parameter demagCoarse controls if the kernel is defined on a coarser discretization level. Parameter exchInConv controls if exchange is included in the kernel

\begin{DoxyAuthor}{Author}
Ben Van de Wiele 
\end{DoxyAuthor}


\subsection{Function Documentation}
\hypertarget{gpu__micromag2d__kernel_8h_a3bd5e71e192bf450b0f0dccfcb6be275}{
\index{gpu\_\-micromag2d\_\-kernel.h@{gpu\_\-micromag2d\_\-kernel.h}!\_\-gpu\_\-extract\_\-real\_\-parts\_\-micromag2d@{\_\-gpu\_\-extract\_\-real\_\-parts\_\-micromag2d}}
\index{\_\-gpu\_\-extract\_\-real\_\-parts\_\-micromag2d@{\_\-gpu\_\-extract\_\-real\_\-parts\_\-micromag2d}!gpu_micromag2d_kernel.h@{gpu\_\-micromag2d\_\-kernel.h}}
\subsubsection[{\_\-gpu\_\-extract\_\-real\_\-parts\_\-micromag2d}]{\setlength{\rightskip}{0pt plus 5cm}\_\-\_\-global\_\-\_\- void \_\-gpu\_\-extract\_\-real\_\-parts\_\-micromag2d (float $\ast$ {\em dev\_\-kernel\_\-array}, \/  float $\ast$ {\em dev\_\-temp})}}
\label{gpu__micromag2d__kernel_8h_a3bd5e71e192bf450b0f0dccfcb6be275}
Extracts the 'size1' real numbers from the array 'dev\_\-temp' and stores them in the 'dev\_\-kernel\_\-array' starting from '\&dev\_\-kernel\_\-array\mbox{[}rank0$\ast$size1\mbox{]}'. 
\begin{DoxyParams}{Parameters}
\item[{\em dev\_\-kernel\_\-array}]pointer to the first kernel element of the considered tensor element \item[{\em dev\_\-temp}]pointer to the temporary memory space on the device to store all elements of a given Greens tensor component \end{DoxyParams}
\hypertarget{gpu__micromag2d__kernel_8h_ad89b6a93d5e726c5dba1a894ce72dbd8}{
\index{gpu\_\-micromag2d\_\-kernel.h@{gpu\_\-micromag2d\_\-kernel.h}!\_\-gpu\_\-get\_\-Greens\_\-element\_\-micromag2d@{\_\-gpu\_\-get\_\-Greens\_\-element\_\-micromag2d}}
\index{\_\-gpu\_\-get\_\-Greens\_\-element\_\-micromag2d@{\_\-gpu\_\-get\_\-Greens\_\-element\_\-micromag2d}!gpu_micromag2d_kernel.h@{gpu\_\-micromag2d\_\-kernel.h}}
\subsubsection[{\_\-gpu\_\-get\_\-Greens\_\-element\_\-micromag2d}]{\setlength{\rightskip}{0pt plus 5cm}\_\-\_\-device\_\-\_\- float \_\-gpu\_\-get\_\-Greens\_\-element\_\-micromag2d (int {\em Nkernel\_\-Y}, \/  int {\em Nkernel\_\-Z}, \/  int {\em exchInConv\_\-Y}, \/  int {\em exchInConv\_\-Z}, \/  int {\em co1}, \/  int {\em co2}, \/  int {\em b}, \/  int {\em c}, \/  float {\em FD\_\-cell\_\-size\_\-Y}, \/  float {\em FD\_\-cell\_\-size\_\-Z}, \/  int {\em repetition\_\-Y}, \/  int {\em repetition\_\-Z}, \/  float $\ast$ {\em dev\_\-qd\_\-P\_\-10}, \/  float $\ast$ {\em dev\_\-qd\_\-W\_\-10})}}
\label{gpu__micromag2d__kernel_8h_ad89b6a93d5e726c5dba1a894ce72dbd8}
Returns an element with coordinates \mbox{[}0,a,b\mbox{]} of the Greens kernel component defined by 'co1, co2'. 
\begin{DoxyParams}{Parameters}
\item[{\em Nkernel\_\-Y}]Non-\/strided size of the kernel data (y-\/direction) \item[{\em Nkernel\_\-Z}]Non-\/strided size of the kernel data (z-\/direction) \item[{\em exchInConv\_\-Y}]1 if exchange is to be included in the y-\/direction \item[{\em exchInConv\_\-Z}]1 if exchange is to be included in the z-\/direction \item[{\em co1}]co1 and co2 define the requested Greens tensor component: e.g. co1=0, co2=1 defines gxy \item[{\em co2}]co1 and co2 define the requested Greens tensor component: e.g. co1=0, co2=1 defines gxy \item[{\em b}]\mbox{[}b,c\mbox{]} defines the cartesian vector pointing to the source FD cell to the receiver FD cell (in units FD cell size) \item[{\em c}]\mbox{[}b,c\mbox{]} defines the cartesian vector pointing to the source FD cell to the receiver FD cell (in units FD cell size) \item[{\em FD\_\-cell\_\-size\_\-Y}]Size of the used FD cells in the y direction \item[{\em FD\_\-cell\_\-size\_\-Z}]Size of the used FD cells in the z direction \item[{\em repetition\_\-Y}]2$\ast$repetition\_\-Y+1 is the number of periods considered the y-\/direction (repetition\_\-Y=0 means no repetion in y direction) \item[{\em repetition\_\-Z}]2$\ast$repetition\_\-Z+1 is the number of periods considered the z-\/direction (repetition\_\-Z=0 means no repetion in z direction) \item[{\em dev\_\-qd\_\-P\_\-10}]float array (30 floats) containing the 10 Gauss quadrature points for X, Y and Z contiguously (on device) \item[{\em dev\_\-qd\_\-W\_\-10}]float array (10 floats) containing the 10 Gauss quadrature weights (on device) \end{DoxyParams}
\hypertarget{gpu__micromag2d__kernel_8h_a75d46c5dc5252ea534486569520c04b4}{
\index{gpu\_\-micromag2d\_\-kernel.h@{gpu\_\-micromag2d\_\-kernel.h}!\_\-gpu\_\-init\_\-Greens\_\-kernel\_\-elements\_\-micromag2d@{\_\-gpu\_\-init\_\-Greens\_\-kernel\_\-elements\_\-micromag2d}}
\index{\_\-gpu\_\-init\_\-Greens\_\-kernel\_\-elements\_\-micromag2d@{\_\-gpu\_\-init\_\-Greens\_\-kernel\_\-elements\_\-micromag2d}!gpu_micromag2d_kernel.h@{gpu\_\-micromag2d\_\-kernel.h}}
\subsubsection[{\_\-gpu\_\-init\_\-Greens\_\-kernel\_\-elements\_\-micromag2d}]{\setlength{\rightskip}{0pt plus 5cm}\_\-\_\-global\_\-\_\- void \_\-gpu\_\-init\_\-Greens\_\-kernel\_\-elements\_\-micromag2d (float $\ast$ {\em dev\_\-temp}, \/  int {\em Nkernel\_\-Y}, \/  int {\em Nkernel\_\-Z}, \/  int {\em Nkernel\_\-storage\_\-Z}, \/  int {\em exchInConv\_\-Y}, \/  int {\em exchInConv\_\-Z}, \/  int {\em co1}, \/  int {\em co2}, \/  float {\em FD\_\-cell\_\-size\_\-Y}, \/  float {\em FD\_\-cell\_\-size\_\-Z}, \/  int {\em repetition\_\-Y}, \/  int {\em repetition\_\-Z}, \/  float $\ast$ {\em qd\_\-P\_\-10}, \/  float $\ast$ {\em qd\_\-W\_\-10})}}
\label{gpu__micromag2d__kernel_8h_a75d46c5dc5252ea534486569520c04b4}
Computes all elements of the Greens kernel component defined by 'co1, co2'. 
\begin{DoxyParams}{Parameters}
\item[{\em dev\_\-temp}]pointer to the temporary memory space on the device to store all elements of a given Greens tensor component \item[{\em Nkernel\_\-Y}]Non-\/strided size of the kernel data (y-\/direction) \item[{\em Nkernel\_\-Z}]Non-\/strided size of the kernel data (z-\/direction) \item[{\em Nkernel\_\-storage\_\-Z}]Strided size of the kernel data in z-\/direction \item[{\em exchInConv\_\-Y}]1 if exchange is to be included in the y-\/direction \item[{\em exchInConv\_\-Z}]1 if exchange is to be included in the z-\/direction \item[{\em co1}]co1 and co2 define the requested Greens tensor component: e.g. co1=0, co2=1 defines gxy \item[{\em co2}]co1 and co2 define the requested Greens tensor component: e.g. co1=0, co2=1 defines gxy \item[{\em FD\_\-cell\_\-size\_\-Y}]Size of the used FD cells in the y direction \item[{\em FD\_\-cell\_\-size\_\-Z}]Size of the used FD cells in the z direction \item[{\em repetition\_\-Y}]2$\ast$repetition\_\-Y+1 is the number of periods considered the y-\/direction (repetition\_\-Y=0 means no repetion in y direction) \item[{\em repetition\_\-Z}]2$\ast$repetition\_\-Z+1 is the number of periods considered the z-\/direction (repetition\_\-Z=0 means no repetion in z direction) \item[{\em qd\_\-P\_\-10}]float array (30 floats) containing the 10 Gauss quadrature points for X, Y and Z contiguously (on device) \item[{\em qd\_\-W\_\-10}]float array (10 floats) containing the 10 Gauss quadrature weights (on device) \end{DoxyParams}
\hypertarget{gpu__micromag2d__kernel_8h_a1fdce7ad13365fdcea39fa6e8d795b9a}{
\index{gpu\_\-micromag2d\_\-kernel.h@{gpu\_\-micromag2d\_\-kernel.h}!get\_\-Quad\_\-Points\_\-micromag2d@{get\_\-Quad\_\-Points\_\-micromag2d}}
\index{get\_\-Quad\_\-Points\_\-micromag2d@{get\_\-Quad\_\-Points\_\-micromag2d}!gpu_micromag2d_kernel.h@{gpu\_\-micromag2d\_\-kernel.h}}
\subsubsection[{get\_\-Quad\_\-Points\_\-micromag2d}]{\setlength{\rightskip}{0pt plus 5cm}void get\_\-Quad\_\-Points\_\-micromag2d (float $\ast$ {\em gaussQP}, \/  float $\ast$ {\em stdgaussQ}, \/  int {\em qOrder}, \/  double {\em a}, \/  double {\em b})}}
\label{gpu__micromag2d__kernel_8h_a1fdce7ad13365fdcea39fa6e8d795b9a}
Get the quadrature points for integration between a and b 
\begin{DoxyParams}{Parameters}
\item[{\em gaussQP}]float array containing the requested Gauss quadrature points \item[{\em stdgaussQ}]standard Gauss quadrature points between -\/1 and +1 \item[{\em qOrder}]Gauss quadrature order \item[{\em a}]integration lower bound \item[{\em b}]integration upper bound \end{DoxyParams}
\hypertarget{gpu__micromag2d__kernel_8h_a794e8985484e58c2fdf4d4e5d5f5bf82}{
\index{gpu\_\-micromag2d\_\-kernel.h@{gpu\_\-micromag2d\_\-kernel.h}!gpu\_\-init\_\-and\_\-FFT\_\-Greens\_\-kernel\_\-elements\_\-micromag2d@{gpu\_\-init\_\-and\_\-FFT\_\-Greens\_\-kernel\_\-elements\_\-micromag2d}}
\index{gpu\_\-init\_\-and\_\-FFT\_\-Greens\_\-kernel\_\-elements\_\-micromag2d@{gpu\_\-init\_\-and\_\-FFT\_\-Greens\_\-kernel\_\-elements\_\-micromag2d}!gpu_micromag2d_kernel.h@{gpu\_\-micromag2d\_\-kernel.h}}
\subsubsection[{gpu\_\-init\_\-and\_\-FFT\_\-Greens\_\-kernel\_\-elements\_\-micromag2d}]{\setlength{\rightskip}{0pt plus 5cm}void gpu\_\-init\_\-and\_\-FFT\_\-Greens\_\-kernel\_\-elements\_\-micromag2d ({\bf tensor} $\ast$ {\em dev\_\-kernel}, \/  int $\ast$ {\em kernelSize}, \/  int $\ast$ {\em exchInConv}, \/  float $\ast$ {\em FD\_\-cell\_\-size}, \/  int $\ast$ {\em repetition}, \/  float $\ast$ {\em dev\_\-qd\_\-P\_\-10}, \/  float $\ast$ {\em dev\_\-qd\_\-W\_\-10}, \/  {\bf gpuFFT3dPlan} $\ast$ {\em kernel\_\-plan})}}
\label{gpu__micromag2d__kernel_8h_a794e8985484e58c2fdf4d4e5d5f5bf82}
Initializes the Greens kernel elements, Fourier transforms the data and extracts the real parts from the data. (imaginary parts are zero in due to the symmetry) The kernel is only stored at the device. 
\begin{DoxyParams}{Parameters}
\item[{\em dev\_\-kernel}]rank 2 tensor; rank 0: yy, yz, zz parts of symmetrical Greens tensor, rank 1: all data of a Greens kernel component contiguously \item[{\em kernelSize}]Non-\/strided size of the kernel data \item[{\em exchInConv}]3 ints, 1 means exchange is included in the kernel in the considered direction (1st int ignored) \item[{\em FD\_\-cell\_\-size}]3 float, size of finite difference cell in X,Y,Z respectively (1st float ignored) \item[{\em repetition}]3 ints, for periodicity: e.g. 2$\ast$repetition\mbox{[}0\mbox{]}+1 is the number of periods considered the x-\/direction (\mbox{[}0,0,0\mbox{]} means no periodic repetition) (1st int ignored) \item[{\em dev\_\-qd\_\-P\_\-10}]float array (30 floats) containing the 10 Gauss quadrature points for X, Y and Z contiguously (on device) \item[{\em dev\_\-qd\_\-W\_\-10}]float array (10 floats) containing the 10 Gauss quadrature weights (on device) \item[{\em kernel\_\-plan}]FFT plan for the execution of the forward FFT of the kernel. \end{DoxyParams}
\hypertarget{gpu__micromag2d__kernel_8h_a4d3ec41beeae62a440235c9ad7ae4fbf}{
\index{gpu\_\-micromag2d\_\-kernel.h@{gpu\_\-micromag2d\_\-kernel.h}!gpu\_\-micromag2d\_\-kernel@{gpu\_\-micromag2d\_\-kernel}}
\index{gpu\_\-micromag2d\_\-kernel@{gpu\_\-micromag2d\_\-kernel}!gpu_micromag2d_kernel.h@{gpu\_\-micromag2d\_\-kernel.h}}
\subsubsection[{gpu\_\-micromag2d\_\-kernel}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tensor}$\ast$ gpu\_\-micromag2d\_\-kernel ({\bf param} $\ast$ {\em p})}}
\label{gpu__micromag2d__kernel_8h_a4d3ec41beeae62a440235c9ad7ae4fbf}
Returns the initialized micromagnetic 2D kernel. The kernel is stored as a rank 2 tensor. Invariance of all quantities is considered in the x-\/direction. The first rank contains the Kernel elements \mbox{[}yy, yz, zz\mbox{]}. The second rank contains the contiguous Fourier transformed data of each element. For instants: the contiguous yz-\/data maps the y-\/component of the (Fourier transformed) magnetic field with the z-\/component of the (Fourier transformed) magnetization.

This function includes:
\begin{DoxyItemize}
\item computation of the elements of the Greens kernel components
\item Fourier transformation of the Greens kernel components
\item extraction of the real parts in the Fourier domain (complex parts are zero due to symmetry)
\end{DoxyItemize}

Demag, exchange (if wanted) as well as the correction factor 1/(dimensions FFTs) are included. 
\begin{DoxyParams}{Parameters}
\item[{\em p}]parameter list \end{DoxyParams}
\hypertarget{gpu__micromag2d__kernel_8h_ac5ac30ce506df77ebe6bd98ee1a3b69a}{
\index{gpu\_\-micromag2d\_\-kernel.h@{gpu\_\-micromag2d\_\-kernel.h}!initialize\_\-Gauss\_\-quadrature\_\-on\_\-gpu\_\-micromag2d@{initialize\_\-Gauss\_\-quadrature\_\-on\_\-gpu\_\-micromag2d}}
\index{initialize\_\-Gauss\_\-quadrature\_\-on\_\-gpu\_\-micromag2d@{initialize\_\-Gauss\_\-quadrature\_\-on\_\-gpu\_\-micromag2d}!gpu_micromag2d_kernel.h@{gpu\_\-micromag2d\_\-kernel.h}}
\subsubsection[{initialize\_\-Gauss\_\-quadrature\_\-on\_\-gpu\_\-micromag2d}]{\setlength{\rightskip}{0pt plus 5cm}void initialize\_\-Gauss\_\-quadrature\_\-on\_\-gpu\_\-micromag2d (float $\ast$ {\em dev\_\-qd\_\-W\_\-10}, \/  float $\ast$ {\em dev\_\-qd\_\-P\_\-10}, \/  float $\ast$ {\em FD\_\-cell\_\-size})}}
\label{gpu__micromag2d__kernel_8h_ac5ac30ce506df77ebe6bd98ee1a3b69a}
Initialization of the Gauss quadrature points and quadrature weights to be used for integration over the FD cell faces. A ten points Gauss quadrature formula is used. The obtained quadrature weights and points are copied to the device. 
\begin{DoxyParams}{Parameters}
\item[{\em dev\_\-qd\_\-W\_\-10}]float array (10 floats) containing the 10 Gauss quadrature weights (on device) \item[{\em dev\_\-qd\_\-P\_\-10}]float array (20 floats) containing the 10 Gauss quadrature points for Y and Z contiguously (on device) \item[{\em FD\_\-cell\_\-size}]3 floats: the dimensions of the used FD cell, (X, Y, Z) respectively \end{DoxyParams}
